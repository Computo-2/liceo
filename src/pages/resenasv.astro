<br>
<section class="relative w-full overflow-hidden">
  
  <!-- Track -->
  <div
    id="review-carousel"
    class="flex will-change-transform select-none"
    style="transform: translate3d(0,0,0); transition: transform 0.7s ease;"
  >
    <!-- Slides -->
    <div class="p-3 carousel-item">
      <div class="bg-white rounded-xl shadow-lg overflow-hidden flex flex-col h-full">
        <div class="relative aspect-video bg-black">
          <div
            class="absolute inset-0 w-full h-full vimeo-placeholder"
            data-src="https://player.vimeo.com/video/1120240210?title=0&byline=0&portrait=0&autopause=1"
          ></div>
        </div>
        <!-- Nombre simple -->
        <div class="p-3 text-center">
          <p class="font-semibold">Ex Alumno 1</p>
        </div>
      </div>
    </div>

    <div class="p-3 carousel-item">
      <div class="bg-white rounded-xl shadow-lg overflow-hidden flex flex-col h-full">
        <div class="relative aspect-video bg-black">
          <div
            class="absolute inset-0 w-full h-full vimeo-placeholder"
            data-src="https://player.vimeo.com/video/1120215980?title=0&byline=0&portrait=0&autopause=1"
          ></div>
        </div>
        <div class="p-3 text-center">
          <p class="font-semibold">Ex Alumno 2</p>
        </div>
      </div>
    </div>

    <div class="p-3 carousel-item">
      <div class="bg-white rounded-xl shadow-lg overflow-hidden flex flex-col h-full">
        <div class="relative aspect-video bg-black">
          <div
            class="absolute inset-0 w-full h-full vimeo-placeholder"
            data-src="https://player.vimeo.com/video/1120223031?title=0&byline=0&portrait=0&autopause=1"
          ></div>
        </div>
        <div class="p-3 text-center">
          <p class="font-semibold">Ex Alumno 3</p>
        </div>
      </div>
    </div>
  </div>
<br>
  <!-- Controles -->
  <div class="pointer-events-none absolute inset-y-0 left-0 right-0 z-11 flex items-center justify-between px-2 md:px-4">
    <button
      id="prev"
      aria-label="Anterior"
      class="pointer-events-auto inline-flex items-center justify-center w-12 h-12 md:w-14 md:h-14 rounded-full bg-white/80 backdrop-blur ring-1 ring-black/10 shadow-lg hover:bg-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500/70 transition"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 md:w-8 md:h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </button>

    <button
      id="next"
      aria-label="Siguiente"
      class="pointer-events-auto inline-flex items-center justify-center w-12 h-12 md:w-14 md:h-14 rounded-full bg-white/80 backdrop-blur ring-1 ring-black/10 shadow-lg hover:bg-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500/70 transition"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 md:w-8 md:h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 6l6 6-6 6"/>
      </svg>
    </button>
  </div>
</section>

<script type="module">
  const track = document.getElementById('review-carousel');
  const BTN_NEXT = document.getElementById('next');
  const BTN_PREV = document.getElementById('prev');

  let slidesBase = Array.from(track.querySelectorAll('.carousel-item'));
  let slides;
  let index = 0;
  let slideWidth = 0;
  let visibleCount = 1;
  let clonesHead = [];
  let clonesTail = [];
  let isAnimating = false;

  function computeVisibleCount() {
    return window.matchMedia('(min-width: 768px)').matches ? 3 : 1;
  }

  function setWidths() {
    const containerWidth = track.parentElement.clientWidth;
    slides = Array.from(track.querySelectorAll('.carousel-item'));
    slides.forEach((s) => {
      s.style.minWidth = `${containerWidth / visibleCount}px`;
      s.style.maxWidth = `${containerWidth / visibleCount}px`;
      s.style.flex = '0 0 auto';
    });
    slideWidth = containerWidth / visibleCount;
  }

  function hydrateIframeIfNeeded(i) {
    const start = i;
    const end = i + visibleCount - 1;
    for (let k = start; k <= end; k++) {
      const slide = slides[k];
      if (!slide) continue;
      const ph = slide.querySelector('.vimeo-placeholder');
      if (ph && !ph.dataset.mounted) {
        const iframe = document.createElement('iframe');
        iframe.className = 'absolute inset-0 w-full h-full';
        iframe.setAttribute('frameborder', '0');
        iframe.setAttribute('allow', 'autoplay; fullscreen; picture-in-picture');
        iframe.setAttribute('allowfullscreen', '');
        iframe.src = ph.dataset.src;
        ph.replaceWith(iframe);
        slide.dataset.vimeoMounted = '1';
        ph.dataset.mounted = '1';
      }
    }
  }

  function pauseAllIframesExcept(i) {
    const start = i;
    const end = i + visibleCount - 1;
    slides.forEach((s, idx) => {
      if (idx >= start && idx <= end) return;
      const iframe = s.querySelector('iframe');
      if (iframe && iframe.contentWindow) {
        iframe.contentWindow.postMessage({ method: 'pause' }, '*');
      }
    });
  }

  function buildClones() {
    clonesHead.forEach(n => n.remove());
    clonesTail.forEach(n => n.remove());
    clonesHead = [];
    clonesTail = [];

    const N = visibleCount;
    const firstN = slidesBase.slice(0, N).map(s => s.cloneNode(true));
    const lastN = slidesBase.slice(-N).map(s => s.cloneNode(true));

    lastN.forEach(c => track.insertBefore(c, track.firstChild));
    firstN.forEach(c => track.appendChild(c));

    clonesHead = firstN;
    clonesTail = lastN;

    slides = Array.from(track.querySelectorAll('.carousel-item'));
    setWidths();

    index = clonesTail.length;
    jumpTo(index);
    hydrateIframeIfNeeded(index);
  }

  function enableTransition() {
    track.style.transition = 'transform 0.7s ease';
  }
  function disableTransition() {
    track.style.transition = 'none';
  }

  function applyTransform() {
    track.style.transform = `translate3d(${-slideWidth * index}px,0,0)`;
  }

  function jumpTo(i) {
    disableTransition();
    index = i;
    applyTransform();
    requestAnimationFrame(() => {
      void track.offsetHeight;
      enableTransition();
    });
  }

  function goNext() {
    if (isAnimating) return;
    isAnimating = true;
    index += 1;
    applyTransform();
  }
  function goPrev() {
    if (isAnimating) return;
    isAnimating = true;
    index -= 1;
    applyTransform();
  }

  BTN_NEXT.addEventListener('click', goNext);
  BTN_PREV.addEventListener('click', goPrev);

  track.addEventListener('transitionend', () => {
    const total = slides.length;
    const baseLen = slidesBase.length;
    if (index >= total - clonesHead.length) {
      const offset = index - (total - clonesHead.length);
      jumpTo(clonesTail.length + offset);
    }
    if (index < clonesTail.length) {
      const offset = clonesTail.length - index;
      jumpTo(baseLen + clonesTail.length - offset);
    }
    hydrateIframeIfNeeded(index);
    pauseAllIframesExcept(index);
    isAnimating = false;
  });

  function rebuildAll() {
    visibleCount = computeVisibleCount();
    buildClones();
  }

  let resizeRaf;
  window.addEventListener('resize', () => {
    cancelAnimationFrame(resizeRaf);
    resizeRaf = requestAnimationFrame(() => {
      setWidths();
      jumpTo(index);
    });
  });

  // Init
  rebuildAll();
</script>
